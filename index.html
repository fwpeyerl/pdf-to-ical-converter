<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Convert PDF Calendar to iCal</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 2rem; background: #f9f9f9; }
    h1 { color: #333; }
    .container { background: white; padding: 2rem; border-radius: 8px; max-width: 500px; margin: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    input[type="file"] { margin-top: 1rem; }
    .btn { margin-top: 1rem; padding: 0.5rem 1.5rem; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .btn:hover { background: #0056b3; }
    #downloadLink { margin-top: 2rem; display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Upload PDF Calendar</h1>
    <p>Convert your monthly PDF activity calendar to an iCal (.ics) file.</p>
    <form id="uploadForm">
  <input type="file" id="pdfInput" accept="application/pdf" required />
  <br>
  <button type="submit" id="convertButton">Convert to iCal</button>
</form>
<a id="downloadLink" style="display:none;" download="converted-calendar.ics">Download iCal</a>
  </div>

<script>
document.getElementById("uploadForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const fileInput = document.getElementById("pdfInput");
  const file = fileInput.files[0];

  console.log("Submit clicked");
  if (!file) {
    console.log("No file selected");
    alert("Please choose a PDF file first.");
    return;
  }

  console.log("File selected:", file.name);

  try {
    const arrayBuffer = await file.arrayBuffer();
    const base64 = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));

    console.log("File converted to base64");

    const response = await fetch("/.netlify/functions/pdfToIcal", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        isBase64Encoded: true,
        body: base64
      })
    });

    console.log("Response status:", response.status);
    if (!response.ok) {
      throw new Error("Server error: " + response.statusText);
    }

    const blob = await response.blob();
    const url = URL.createObjectURL(blob);

    const downloadLink = document.getElementById("downloadLink");
    downloadLink.href = url;
    downloadLink.style.display = "inline-block";

    console.log("Download link ready");

  } catch (error) {
    console.error("Error during conversion:", error.message);
    alert("Error: " + error.message);
  }
});
</script>


</body>
</html>
